#!/bin/bash


# Get pixel width of file
# mediainfo $file | grep "Width" | sed 's/^.*\(:\)//' | sed 's/\(pixels\).*//' | sed 's/\ //'

#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
#-----SCRIPT CONFIG--------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#

script=$0
cd `dirname $script`
script_directory=$(pwd -P)

configfile="$script_directory/media_centre_config.conf"

#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
#-----FUNCTIONS------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#

script_already_running () {
grep_output=$(ps -efa | grep "HandBrakeCLI -i $HOME/Movies/Discs/" | grep -v 'grep ')
if [ grep_output == "" ]; then
	script_already_running=true
	echo "
Script is already running, will not continue.
	" >&2
else
	script_already_running=false
	echo "
Script is not already running, will proceed.
	" >&2
fi
}

rename_folder_with_filebot () {
files_to_rename=$1/*
for video_file in $files_to_rename
do
	name_file=$(basename $video_file)
	echo "
Processing "$name_file" with filebot...
"
	filebot -rename -non-strict --db thetvdb "$video_file" | grep "$video_file"
	
done
}

#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
#-----SCRIPT START---------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#

script_already_running

rename_folder_with_filebot "$HOME/Movies/TV"